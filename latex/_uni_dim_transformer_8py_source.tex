\doxysection{Uni\+Dim\+Transformer.\+py}
\hypertarget{_uni_dim_transformer_8py_source}{}\label{_uni_dim_transformer_8py_source}\index{src/UniDimTransformer.py@{src/UniDimTransformer.py}}
\mbox{\hyperlink{_uni_dim_transformer_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00001}\mbox{\hyperlink{namespacesrc_1_1_uni_dim_transformer}{00001}}\ \textcolor{stringliteral}{'''This\ module\ trains\ a\ univariate\ Transformer\ model\ for\ time\ series\ forecasting'''}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00002}00002\ \textcolor{keyword}{import}\ os}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00003}00003\ \textcolor{keyword}{import}\ random}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00004}00004\ \textcolor{keyword}{import}\ sys}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00005}00005\ \textcolor{keyword}{import}\ time}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00006}00006\ \textcolor{keyword}{import}\ warnings}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00007}00007\ \textcolor{keyword}{import}\ argparse}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00008}00008\ \textcolor{keyword}{import}\ pandas\ \textcolor{keyword}{as}\ pd}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00009}00009\ \textcolor{keyword}{import}\ torch}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00010}00010\ \textcolor{keyword}{import}\ torch.nn\ \textcolor{keyword}{as}\ nn}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00011}00011\ \textcolor{keyword}{import}\ torch.optim\ \textcolor{keyword}{as}\ optim}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00012}00012\ \textcolor{keyword}{from}\ sklearn.metrics\ \textcolor{keyword}{import}\ mean\_squared\_error,\ mean\_absolute\_error}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00013}00013\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00014}00014\ \textcolor{keyword}{from}\ utils\_vv\_tfg\ \textcolor{keyword}{import}\ save\_data,\ load\_preprocessed\_data,\ denormalize\_data}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00015}00015\ \textcolor{keyword}{from}\ config.config\ \textcolor{keyword}{import}\ get\_configuration}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00016}00016\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00017}00017\ warnings.filterwarnings(\textcolor{stringliteral}{'ignore'})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00018}00018\ warnings.simplefilter(\textcolor{stringliteral}{'ignore'})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00019}00019\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00020}00020\ \textcolor{keyword}{import}\ torch}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00021}00021\ \textcolor{keyword}{import}\ torch.nn\ \textcolor{keyword}{as}\ nn}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00022}00022\ \textcolor{keyword}{import}\ torch.nn.functional\ \textcolor{keyword}{as}\ F}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00023}00023\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00024}\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l}{00024}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l}{TransformerL}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00025}00025\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00026}00026\ \textcolor{stringliteral}{\ \ \ \ Transformer-\/based\ model\ for\ time\ series\ forecasting.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00027}00027\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00028}\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_aa7e2ae5e10aedeb6a7b1a3103fbd2bac}{00028}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_aa7e2ae5e10aedeb6a7b1a3103fbd2bac}{\_\_init\_\_}}(self,\ input\_dim:\ int,\ embed\_dim:\ int,\ num\_layers:\ int,\ num\_heads:\ int,\ dropout:\ float):}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00029}00029\ \ \ \ \ \ \ \ \ super(TransformerL,\ self).\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_aa7e2ae5e10aedeb6a7b1a3103fbd2bac}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00030}\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a12fab2bba071726e77eac30bdac611bd}{00030}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a12fab2bba071726e77eac30bdac611bd}{input\_dim}}\ =\ input\_dim}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00031}\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_af85fad7f8232d0523baad00ca36781c7}{00031}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_af85fad7f8232d0523baad00ca36781c7}{embed\_dim}}\ =\ embed\_dim}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00032}\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_ada6e51bb89797487cabcd717e93a00fc}{00032}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_ada6e51bb89797487cabcd717e93a00fc}{num\_layers}}\ =\ num\_layers}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00033}\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a6d3bfcc8e29e3261e85542b14040ed43}{00033}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a6d3bfcc8e29e3261e85542b14040ed43}{num\_heads}}\ =\ num\_heads}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00034}\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a8bdde3efaec8862953281596f140d965}{00034}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a8bdde3efaec8862953281596f140d965}{dropout}}\ =\ dropout}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00035}00035\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00036}\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a1cacda2012808d7cb5679abc50bcd3a6}{00036}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a1cacda2012808d7cb5679abc50bcd3a6}{embedding}}\ =\ nn.Linear(self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a12fab2bba071726e77eac30bdac611bd}{input\_dim}},\ self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_af85fad7f8232d0523baad00ca36781c7}{embed\_dim}})\ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00037}\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_aa9f7943646c0d9a4f8277c1d70d592cf}{00037}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_aa9f7943646c0d9a4f8277c1d70d592cf}{encoder\_layers}}\ =\ nn.ModuleList([nn.TransformerEncoderLayer(self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_af85fad7f8232d0523baad00ca36781c7}{embed\_dim}},\ self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a6d3bfcc8e29e3261e85542b14040ed43}{num\_heads}},\ dim\_feedforward=4*self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_af85fad7f8232d0523baad00ca36781c7}{embed\_dim}},\ dropout=self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a8bdde3efaec8862953281596f140d965}{dropout}})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00038}00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ \_\ \textcolor{keywordflow}{in}\ range(self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_ada6e51bb89797487cabcd717e93a00fc}{num\_layers}})])}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00039}\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a454669de7506bdd02f0e5eea9cbf6300}{00039}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a454669de7506bdd02f0e5eea9cbf6300}{output\_layer}}\ =\ nn.Linear(self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_af85fad7f8232d0523baad00ca36781c7}{embed\_dim}},\ 1)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00040}00040\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00041}\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a9e1f6619d9e2d7ab81c491b148fe4cc6}{00041}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a9e1f6619d9e2d7ab81c491b148fe4cc6}{forward}}(self,\ src)\ -\/>\ torch.Tensor:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00042}00042\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00043}00043\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Forward\ pass\ of\ the\ Transformer\ model.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00044}00044\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00045}00045\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Parameters}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00046}00046\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00047}00047\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ src\ :\ torch.Tensor}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00048}00048\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ Input\ tensor\ of\ shape\ (batch\_size,\ seq\_length,\ input\_dim).}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00049}00049\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00050}00050\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Returns}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00051}00051\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00052}00052\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ torch.Tensor}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00053}00053\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ Output\ tensor\ of\ shape\ (batch\_size,\ seq\_length,\ 1).}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00054}00054\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00055}00055\ \ \ \ \ \ \ \ \ src\_embedded\ =\ self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a1cacda2012808d7cb5679abc50bcd3a6}{embedding}}(src)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00056}00056\ \ \ \ \ \ \ \ \ src\_embedded\ =\ src\_embedded.permute(1,\ 0,\ 2)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00057}00057\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00058}00058\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ encoder\ \textcolor{keywordflow}{in}\ self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_aa9f7943646c0d9a4f8277c1d70d592cf}{encoder\_layers}}:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00059}00059\ \ \ \ \ \ \ \ \ \ \ \ \ src\_embedded\ =\ encoder(src\_embedded)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00060}00060\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00061}00061\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#src\_embedded\ =\ src\_embedded.permute(1,\ 0,\ 2)\ \ \#\ Volvemos\ a\ la\ forma\ original\ (batch,\ seq,\ embed)}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00062}00062\ \ \ \ \ \ \ \ \ output\ =\ self.\mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l_a454669de7506bdd02f0e5eea9cbf6300}{output\_layer}}(src\_embedded)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00063}00063\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ output}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00064}00064\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00066}\mbox{\hyperlink{namespacesrc_1_1_uni_dim_transformer_a513e0ed9d7f4031041a0e616bfc4e3d3}{00066}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacesrc_1_1_uni_dim_transformer_a513e0ed9d7f4031041a0e616bfc4e3d3}{transformer\_fun}}(transformer\_parameters:\ dict,\ train\_X:\ pd.DataFrame,\ train\_y:\ pd.DataFrame,\ test\_X:\ pd.DataFrame,\ test\_y:\ pd.DataFrame,}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00067}00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Y:\ pd.DataFrame,\ vdd:\ dict,\ epochs:\ int,\ bsize:\ int,\ nhn:\ int,\ win:\ int,\ n\_ftrs:\ int,\ ahead:\ int,\ stock:\ str,\ seed:\ int)\ -\/>\ dict:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00068}00068\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00069}00069\ \textcolor{stringliteral}{\ \ \ \ Trains\ a\ Transformer\ model\ for\ time\ series\ forecasting.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00070}00070\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00071}00071\ \textcolor{stringliteral}{\ \ \ \ Parameters}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00072}00072\ \textcolor{stringliteral}{\ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00073}00073\ \textcolor{stringliteral}{\ \ \ \ transformer\_parameters\ :\ dict}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00074}00074\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Dictionary\ containing\ the\ number\ of\ layers\ and\ heads\ for\ the\ Transformer\ model.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00075}00075\ \textcolor{stringliteral}{\ \ \ \ train\_X\ :\ pd.DataFrame}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00076}00076\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Training\ input\ data.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00077}00077\ \textcolor{stringliteral}{\ \ \ \ train\_y\ :\ pd.DataFrame}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00078}00078\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Training\ target\ data.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00079}00079\ \textcolor{stringliteral}{\ \ \ \ test\_X\ :\ pd.DataFrame}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00080}00080\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Test\ input\ data.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00081}00081\ \textcolor{stringliteral}{\ \ \ \ test\_y\ :\ pd.DataFrame}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00082}00082\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Test\ target\ data.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00083}00083\ \textcolor{stringliteral}{\ \ \ \ Y\ :\ pd.DataFrame}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00084}00084\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Target\ data.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00085}00085\ \textcolor{stringliteral}{\ \ \ \ vdd\ :\ dict}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00086}00086\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Dictionary\ containing\ the\ mean,\ min,\ and\ max\ values\ used\ for\ normalization.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00087}00087\ \textcolor{stringliteral}{\ \ \ \ epochs\ :\ int}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00088}00088\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Number\ of\ epochs.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00089}00089\ \textcolor{stringliteral}{\ \ \ \ bsize\ :\ int}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00090}00090\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Batch\ size.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00091}00091\ \textcolor{stringliteral}{\ \ \ \ nhn\ :\ int}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00092}00092\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Number\ of\ hidden\ neurons\ (embedding\ dimension).}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00093}00093\ \textcolor{stringliteral}{\ \ \ \ win\ :\ int}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00094}00094\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Window\ size.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00095}00095\ \textcolor{stringliteral}{\ \ \ \ n\_ftrs\ :\ int}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00096}00096\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Number\ of\ features.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00097}00097\ \textcolor{stringliteral}{\ \ \ \ ahead\ :\ int}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00098}00098\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Number\ of\ days\ ahead.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00099}00099\ \textcolor{stringliteral}{\ \ \ \ stock\ :\ str}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00100}00100\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Stock\ ticker.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00101}00101\ \textcolor{stringliteral}{\ \ \ \ seed\ :\ int}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00102}00102\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Random\ seed.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00103}00103\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00104}00104\ \textcolor{stringliteral}{\ \ \ \ Returns}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00105}00105\ \textcolor{stringliteral}{\ \ \ \ -\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00106}00106\ \textcolor{stringliteral}{\ \ \ \ dict}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00107}00107\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Dictionary\ containing\ the\ results\ of\ the\ Transformer\ model\ training.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00108}00108\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00109}00109\ \ \ \ \ \textcolor{comment}{\#\ Convert\ to\ PyTorch\ tensors}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00110}00110\ \ \ \ \ device\ =\ torch.device(\textcolor{stringliteral}{'cuda'}\ \textcolor{keywordflow}{if}\ torch.cuda.is\_available()\ \textcolor{keywordflow}{else}\ \textcolor{stringliteral}{'cpu'})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00111}00111\ \ \ \ \ np\_train\_X\ =\ torch.tensor(train\_X.to\_numpy().reshape(train\_X.shape[1],\ train\_X.shape[0],\ n\_ftrs),}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00112}00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dtype=torch.float32).to(device)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00113}00113\ \ \ \ \ np\_train\_y\ =\ torch.tensor(train\_y.to\_numpy(),\ dtype=torch.float32).to(device)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00114}00114\ \ \ \ \ np\_test\_X\ =\ torch.tensor(test\_X.to\_numpy().reshape(test\_X.shape[1],\ test\_X.shape[0],\ n\_ftrs),\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00115}00115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dtype=torch.float32).to(device)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00116}00116\ \ \ \ \ np\_test\_y\ =\ torch.tensor(test\_y.to\_numpy(),\ dtype=torch.float32).to(device)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00117}00117\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00118}00118\ \ \ \ \ nit\ =\ 0}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00119}00119\ \ \ \ \ lloss\ =\ float(\textcolor{stringliteral}{'nan'})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00120}00120\ \ \ \ \ model\ =\ \mbox{\hyperlink{classsrc_1_1_uni_dim_transformer_1_1_transformer_l}{TransformerL}}(input\_dim=(np\_train\_X.shape[2]),\ embed\_dim=nhn,\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00121}00121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ num\_layers=transformer\_parameters[\textcolor{stringliteral}{'num\_layers'}],\ num\_heads=transformer\_parameters[\textcolor{stringliteral}{'num\_heads'}],\ dropout=0.05)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00122}00122\ \ \ \ \ model.to(device)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00123}00123\ \ \ \ \ \textcolor{keywordflow}{while}\ torch.isnan(torch.Tensor([lloss]))\ \textcolor{keywordflow}{and}\ nit\ <\ 5:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00124}00124\ \ \ \ \ \ \ \ \ torch.manual\_seed(seed)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00125}00125\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Define\ the\ loss\ function\ and\ optimizer}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00126}00126\ \ \ \ \ \ \ \ \ criterion\ =\ nn.MSELoss()}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00127}00127\ \ \ \ \ \ \ \ \ optimizer\ =\ optim.AdamW(model.parameters(),\ lr=0.001)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00128}00128\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00129}00129\ \ \ \ \ \ \ \ \ outputs\ =\ []}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00130}00130\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Train\ the\ model}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00131}00131\ \ \ \ \ \ \ \ \ print(\textcolor{stringliteral}{"{}Training\ the\ model..."{}})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00132}00132\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ epoch\ \textcolor{keywordflow}{in}\ range(epochs):}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00133}00133\ \ \ \ \ \ \ \ \ \ \ \ \ optimizer.zero\_grad()}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00134}00134\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ range(0,\ len(np\_train\_X),\ bsize):}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00135}00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ batch\_np\_train\_X\ =\ np\_train\_X[:,\ i:i+bsize,\ :].to(device)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00136}00136\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ batch\_np\_train\_y\ =\ np\_train\_y[i:i+bsize].to(device)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00137}00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\ =\ model(batch\_np\_train\_X)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00138}00138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ loss\ =\ criterion(output,\ batch\_np\_train\_y)\ \ \textcolor{comment}{\#\ Unsqueeze\ to\ match\ output\ shape}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00139}00139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ loss.backward()}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00140}00140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ optimizer.step()}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00141}00141\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ epoch\ \%\ 10\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00142}00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{"{}Epoch\ [\{epoch+1\}/\{epochs\}]:"{}})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00143}00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{"{}Train\ Loss:\ \{loss.item()\}"{}})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00144}00144\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#Evaluate\ the\ model}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00145}00145\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ torch.no\_grad():}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00146}00146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ y\_hat\ \ =\ model(np\_test\_X)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00147}00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ test\_loss\ =\ criterion(y\_hat,\ np\_test\_y)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00148}00148\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ epoch\ \%\ 10\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00149}00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{"{}Test\ Loss:\ \{test\_loss.item()\}"{}})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00150}00150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(\textcolor{stringliteral}{'-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/'})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00151}00151\ \ \ \ \ \ \ \ \ outputs.append(y\_hat.cpu().detach().numpy())}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00152}00152\ \ \ \ \ \ \ \ \ lloss\ =\ loss.item()}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00153}00153\ \ \ \ \ \ \ \ \ nit\ +=\ 1}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00154}00154\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00155}00155\ \ \ \ \ jdx\ =\ test\_X.index}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00156}00156\ \ \ \ \ y\_forecast\ =\ denormalize\_data(outputs[0],\ vdd,\ jdx,\ \textcolor{keyword}{False})\ \textcolor{comment}{\#\ denormalize\ the\ forecast}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00157}00157\ \ \ \ \ y\_real\ \ =\ Y.loc[jdx]\ \textcolor{comment}{\#\ y\ real}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00158}00158\ \ \ \ \ y\_yesterday\ \ =\ Y.shift(ahead).loc[jdx]\ \textcolor{comment}{\#\ Y\ yesterday}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00159}00159\ \ \ \ \ DY\ \ =\ pd.concat([y\_real,y\_forecast,y\_yesterday],axis=1)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00160}00160\ \ \ \ \ DY.columns\ =\ [\textcolor{stringliteral}{'Y\_real'},\textcolor{stringliteral}{'Y\_predicted'},\textcolor{stringliteral}{'Y\_yesterday'}]\ \ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00161}00161\ \ \ \ \ msep\ =\ mean\_squared\_error(DY.Y\_predicted\ ,\ DY.Y\_real)\ \textcolor{comment}{\#\ error\ y\ predicted\ -\/\ y\ real}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00162}00162\ \ \ \ \ msey\ =\ mean\_squared\_error(DY.Y\_yesterday\ ,\ DY.Y\_real)\ \textcolor{comment}{\#\ error\ y\ yesterday\ -\/\ y\ real}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00163}00163\ \ \ \ \ maep\ =\ mean\_absolute\_error(DY.Y\_predicted\ ,\ DY.Y\_real)\ \textcolor{comment}{\#\ error\ y\ predicted\ -\/\ y\ real}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00164}00164\ \ \ \ \ maey\ =\ mean\_absolute\_error(DY.Y\_yesterday\ ,\ DY.Y\_real)\ \textcolor{comment}{\#\ error\ y\ yesterday\ -\/\ y\ real}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00165}00165\ \ \ \ \ \textcolor{comment}{\#\ Prepare\ the\ result\ dictionary}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00166}00166\ \ \ \ \ df\_result\ =\ \{}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00167}00167\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'MSEP'}:\ msep,\textcolor{stringliteral}{'MSEY'}:\ msey,}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00168}00168\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'MAEP'}:\ maep,\ \textcolor{stringliteral}{'MAEY'}:\ maey,\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00169}00169\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'Stock'}:\ stock,\textcolor{stringliteral}{'DY'}:\ DY,}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00170}00170\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'ALG'}:\ \textcolor{stringliteral}{'Transformer'},\textcolor{stringliteral}{'seed'}:\ seed,}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00171}00171\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'epochs'}:\ epoch,\textcolor{stringliteral}{'nhn'}:\ nhn,\textcolor{stringliteral}{'win'}:\ win,}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00172}00172\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'ndims'}:\ 1,\textcolor{stringliteral}{'lossh'}:\ lloss,}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00173}00173\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'nit'}:\ nit,\textcolor{stringliteral}{'model'}:\ model}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00174}00174\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00175}00175\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00176}00176\ \ \ \ \ \textcolor{keywordflow}{return}\ df\_result}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00177}00177\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00178}00178\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00179}\mbox{\hyperlink{namespacesrc_1_1_uni_dim_transformer_a9cc5cab47951567cacb5df19f6cc11b4}{00179}}\ \textcolor{keyword}{def\ }main(args)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00180}00180\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00181}00181\ \textcolor{stringliteral}{\ \ \ \ Main\ function\ to\ train\ a\ Transformer\ model\ for\ time\ series\ forecasting.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00182}00182\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00183}00183\ \textcolor{stringliteral}{\ \ \ \ Parameters}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00184}00184\ \textcolor{stringliteral}{\ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00185}00185\ \textcolor{stringliteral}{\ \ \ \ args\ :\ argparse.Namespace}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00186}00186\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Arguments\ from\ the\ command\ line.}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00187}00187\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00188}00188\ \ \ \ \ config,\ \_\ =\ get\_configuration(args.params\_file)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00189}00189\ \ \ \ \ processed\_path\ =\ config[\textcolor{stringliteral}{'data'}][\textcolor{stringliteral}{'output\_path'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00190}00190\ \ \ \ \ multi\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00191}00191\ \ \ \ \ transformer\_configs\ =\ []}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00192}00192\ \ \ \ \ scenarios\ =\ []}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00193}00193\ \ \ \ \ \textcolor{keywordflow}{for}\ scenario\ \textcolor{keywordflow}{in}\ config[\textcolor{stringliteral}{'scenarios'}]:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00194}00194\ \ \ \ \ \ \ \ \ list\_win\_size\ =\ scenario[\textcolor{stringliteral}{'win'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00195}00195\ \ \ \ \ \ \ \ \ list\_tr\_tst\ =\ scenario[\textcolor{stringliteral}{'tr\_tst'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00196}00196\ \ \ \ \ \ \ \ \ lahead\ =\ scenario[\textcolor{stringliteral}{'lahead'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00197}00197\ \ \ \ \ \ \ \ \ epochs\ =\ scenario[\textcolor{stringliteral}{'epochs'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00198}00198\ \ \ \ \ \ \ \ \ bsize\ =\ scenario[\textcolor{stringliteral}{'batch\_size'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00199}00199\ \ \ \ \ \ \ \ \ nhn\ =\ scenario[\textcolor{stringliteral}{'nhn'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00200}00200\ \ \ \ \ \ \ \ \ n\_itr\ =\ scenario[\textcolor{stringliteral}{'n\_itr'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00201}00201\ \ \ \ \ \ \ \ \ stock\_list\ =\ scenario[\textcolor{stringliteral}{'tickers'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00202}00202\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{'Transformer'}\ \textcolor{keywordflow}{in}\ scenario:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00203}00203\ \ \ \ \ \ \ \ \ \ \ \ \ transformer\_configs.append(scenario[\textcolor{stringliteral}{'Transformer'}])}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00204}00204\ \ \ \ \ \ \ \ \ \ \ \ \ scenarios.append(scenario[\textcolor{stringliteral}{'name'}])}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00205}00205\ \ \ \ \ \ \ \ \ res\ =\ \{\}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00206}00206\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ config\_transformer\ \textcolor{keywordflow}{in}\ enumerate(transformer\_configs):}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00207}00207\ \ \ \ \ \ \ \ \ \ \ \ \ tmod\ =\ config\_transformer[\textcolor{stringliteral}{'model'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00208}00208\ \ \ \ \ \ \ \ \ \ \ \ \ scen\_model\ =\ \textcolor{stringliteral}{'MODEL\_'}+scenario[\textcolor{stringliteral}{'name'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00209}00209\ \ \ \ \ \ \ \ \ \ \ \ \ res[scen\_model]\ =\ tmod}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00210}00210\ \ \ \ \ \ \ \ \ \ \ \ \ num\_layers\ =\ config\_transformer[\textcolor{stringliteral}{'num\_layers'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00211}00211\ \ \ \ \ \ \ \ \ \ \ \ \ num\_heads\ =\ config\_transformer[\textcolor{stringliteral}{'num\_heads'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00212}00212\ \ \ \ \ \ \ \ \ \ \ \ \ transformer\_parameters\ =\ \{}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00213}00213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'num\_layers'}:\ num\_layers,}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00214}00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'num\_heads'}:\ num\_heads}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00215}00215\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00216}00216\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00217}00217\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ win\_size\ \textcolor{keywordflow}{in}\ list\_win\_size:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00218}00218\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ tr\_tst\ \textcolor{keywordflow}{in}\ list\_tr\_tst:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00219}00219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ out\_model\ =\ \{\}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00220}00220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ stock\ \textcolor{keywordflow}{in}\ stock\_list:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00221}00221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lpar,\ tot\_res\ =\ load\_preprocessed\_data(processed\_path,\ win\_size,\ tr\_tst,\ stock,\ scenario[\textcolor{stringliteral}{'name'}],\ multi)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00222}00222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ win,\ n\_ftrs,\ tr\_tst\ =\ lpar}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00223}00223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fmdls\ =\ config[\textcolor{stringliteral}{'data'}][\textcolor{stringliteral}{'fmdls'}].format(nhn=nhn,tmod=tmod,tr\_tst=tr\_tst,stock=stock)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00224}00224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ os.path.exists(fmdls):}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00225}00225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ os.makedirs(fmdls)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00226}00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ res[stock]\ =\ \{\}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00227}00227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{"{}Traning\ for\ \{win\}\ window\ size\ \{tr\_tst*100\}\%\ training\ data"{}})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00228}00228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ ahead\ \textcolor{keywordflow}{in}\ lahead:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00229}00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tot\ =\ tot\_res[\textcolor{stringliteral}{'INPUT\_DATA'}][ahead]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00230}00230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ train\_X\ =\ tot[\textcolor{stringliteral}{'trainX'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00231}00231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ train\_y\ =\ tot[\textcolor{stringliteral}{'trainY'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00232}00232\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ test\_X\ \ =\ tot[\textcolor{stringliteral}{'testX'}]\ \ \ \ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00233}00233\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ test\_y\ \ =\ tot[\textcolor{stringliteral}{'testY'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00234}00234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Y\ \ \ \ \ \ =\ tot[\textcolor{stringliteral}{'y'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00235}00235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ vdd\ \ \ \ =\ tot[\textcolor{stringliteral}{'vdd'}]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00236}00236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tmpr\ =\ []\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00237}00237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ irp\ \textcolor{keywordflow}{in}\ range(n\_itr):}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00238}00238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ seed\ \ \ \ \ \ =\ random.randint(0,1000)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00239}00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(\textcolor{stringliteral}{'\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#'})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00240}00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{'\{irp\}\ Training\ \{stock\}\ \{ahead\}\ days\ ahead.'})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00241}00241\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ transformer\_start=\ time.time()}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00242}00242\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mdl\_name\ \ =\ f\textcolor{stringliteral}{'\{tmod\}-\/\{stock\}-\/\{ahead\}-\/\{irp\}.hd5'}}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00243}00243\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ tmod\ ==\ \textcolor{stringliteral}{"{}transformer"{}}:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00244}00244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sol\ \ \ =\ \mbox{\hyperlink{namespacesrc_1_1_uni_dim_transformer_a513e0ed9d7f4031041a0e616bfc4e3d3}{transformer\_fun}}(transformer\_parameters,train\_X,train\_y,test\_X,test\_y,}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00245}00245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Y,vdd,epochs,bsize,nhn,win,n\_ftrs,ahead,stock,seed)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00246}00246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ transformer\_end\ \ =\ time.time()}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00247}00247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ttrain\ \ \ \ =\ transformer\_end\ -\/\ transformer\_start}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00248}00248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sol[\textcolor{stringliteral}{'ttrain'}]\ =\ ttrain}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00249}00249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sol[\textcolor{stringliteral}{'epochs'}]\ \ =\ epochs}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00250}00250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sol[\textcolor{stringliteral}{'bsize'}]\ \ =\ bsize}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00251}00251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sol[\textcolor{stringliteral}{'nhn'}]\ \ \ \ =\ nhn}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00252}00252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sol[\textcolor{stringliteral}{'win'}]\ \ \ \ =\ win}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00253}00253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sol[\textcolor{stringliteral}{'tr\_tst'}]\ =\ tr\_tst}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00254}00254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sol[\textcolor{stringliteral}{'transformer\_parameters'}]\ =\ transformer\_parameters}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00255}00255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ torch.save(sol[\textcolor{stringliteral}{'model'}],\ fmdls+mdl\_name)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00256}00256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sol[\textcolor{stringliteral}{'model'}]\ \ =\ fmdls+mdl\_name}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00257}00257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(\textcolor{stringliteral}{'\ \ \ Effort\ spent:\ '}\ +\ str(ttrain)\ +\textcolor{stringliteral}{'\ s.'})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00258}00258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sys.stdout.flush()}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00259}00259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tmpr.append(sol)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00260}00260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ res[stock][ahead]\ =\ pd.DataFrame(tmpr)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00261}00261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ out\_model[stock]\ =\ res[stock]}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00262}00262\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00263}00263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tot\_res[\textcolor{stringliteral}{'OUT\_MODEL'}]\ =\ out\_model\ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00264}00264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fdat\ =\ \textcolor{stringliteral}{'\{\}/output/\{\}/\{\}/\{\}-\/\{\}-\/output.pkl'}.format(processed\_path,win,tr\_tst,scenario[\textcolor{stringliteral}{'name'}],tmod)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00265}00265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ os.path.exists(fdat):}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00266}00266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ save\_data(fdat,\ processed\_path,\ lahead,\ lpar,\ tot\_res)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00267}00267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00268}00268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ directory1\ =\ os.path.dirname(fdat)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00269}00269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ os.path.exists(directory1):}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00270}00270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ os.makedirs(directory1)}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00271}00271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{"{}Directory\ \{directory1\}\ created."{}})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00272}00272\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00273}00273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ save\_data(fdat,\ processed\_path,\ lahead,\ lpar,\ tot\_res)\ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00274}00274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{"{}File\ \{fdat\}\ created\ and\ data\ saved."{}})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00275}00275\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00276}00276\ }
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00277}00277\ \textcolor{keywordflow}{if}\ \_\_name\_\_\ ==\ \textcolor{stringliteral}{"{}\_\_main\_\_"{}}:}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00278}\mbox{\hyperlink{namespacesrc_1_1_uni_dim_transformer_a59ec6666855904fba19ee7d44b70ed11}{00278}}\ \ \ \ \ parser\ =\ argparse.ArgumentParser(description=\textcolor{stringliteral}{"{}LSTM\ training,\ testing\ and\ results\ saving."{}})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00279}\mbox{\hyperlink{namespacesrc_1_1_uni_dim_transformer_aca122929685a584d806f2828ba37d8d1}{00279}}\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/c"{}},\ \textcolor{stringliteral}{"{}-\/-\/params\_file"{}},\ nargs=\textcolor{stringliteral}{'?'},\ action=\textcolor{stringliteral}{'store'},\ help=\textcolor{stringliteral}{"{}Configuration\ file\ path"{}})}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00280}\mbox{\hyperlink{namespacesrc_1_1_uni_dim_transformer_a88bd0b403396d3cda24b18bd4f3e806e}{00280}}\ \ \ \ \ args\ =\ parser.parse\_args()}
\DoxyCodeLine{\Hypertarget{_uni_dim_transformer_8py_source_l00281}00281\ \ \ \ \ main(args)}

\end{DoxyCode}
